<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Flyer is Ready!</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #f3f4f6;
            color: #333;
        }
        /* Styles for the flyer display on this page */
        .flyer-display {
            width: 816px; /* 8.5 inches * 96 DPI for consistent print size */
            height: 1056px; /* 11 inches * 96 DPI for consistent print size */
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border: 2px solid #000;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            box-sizing: border-box; /* Include padding and border in total dimensions */
            overflow: hidden; /* Prevent content from spilling */
        }
        /* Styles from lost_pet_flyer.html, adapted for Tailwind context if possible, or kept direct */
        .red-banner {
            background-color: #ef4444; /* Tailwind red-500 */
            color: white;
            width: 100%;
            padding: 10px 0;
            margin: 0;
        }
        .missing {
            font-size: 3rem; /* 48px */
            font-weight: bold;
            text-align: center; /* Center the text */
            letter-spacing: 0.2em; /* Increase letter spacing */
        }
        h2 {
            font-size: 1.5rem; /* 24px */
            margin: 10px 0;
            color: #3b82f6; /* Tailwind blue-500 */
        }
        .pet-name-display {
            font-size: 2.25rem; /* 36px */
            font-weight: bold;
            margin: 20px 0;
            color: #3b82f6; /* Tailwind blue-500 */
        }
        .photo-placeholder-display {
            width: 300px;
            height: 300px;
            background-color: #d1d5db; /* Tailwind gray-300 */
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #000;
            font-style: italic;
            overflow: hidden; /* Ensure image fits */
        }
        .photo-placeholder-display img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Cover the area, cropping if necessary */
        }
        .details-display {
            font-size: 1.125rem; /* 18px */
            margin: 20px 0;
        }
        .reward-display {
            font-size: 1.5rem; /* 24px */
            font-weight: bold;
            color: #10b981; /* Tailwind green-500 */
            margin: 20px 0;
            display: none; /* Hidden by default, shown via JS if needed */
        }
        .contact-display {
            font-size: 1.125rem; /* 18px */
            padding: 10px 0;
            text-align: center; /* Center the text */
        }
    </style>
</head>
<body>
    <div class="max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-xl text-center">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Thank You for Your Payment!</h1>
        <p class="text-lg text-gray-700 mb-8">Your lost pet flyer is ready for download.</p>

        <h2 class="text-2xl font-semibold text-gray-800 mb-4">Your Generated Flyer</h2>
        <!-- This div will hold the reconstructed flyer for display -->
        <div id="reconstructed-flyer-display" class="flyer-display mb-8">
            <!-- Content will be populated by JavaScript -->
            <div class="red-banner missing">MISSING</div>
            <h2 class="text-blue-500">PLEASE HELP US FIND OUR FURRY FRIEND.</h2>
            <div class="pet-name-display text-blue-500" id="displayPetName"></div>
            <div class="photo-placeholder-display" id="displayPhotoPlaceholder"></div>
            <div class="details-display">
                <p>Breed: <span id="displayPetBreed"></span></p>
                <p>Color: <span id="displayPetColor"></span></p>
                <p><span id="displayPetName2"></span> has been missing since <span id="displayMissingDate"></span> at <span id="displayLastSeenLocation"></span></p>
            </div>
            <div class="reward-display" id="displayRewardSection">
                <div id="displayRewardAmount"></div>
                <div>REWARD</div>
            </div>
            <div class="red-banner contact-display">CALL OR TEXT WITH ANY INFORMATION <span id="displayPhoneNumber"></span></div>
        </div>

        <div class="space-y-4">
            <button id="downloadPngBtn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105">
                Download Flyer (PNG)
            </button>
            <button id="downloadPdfBtn" class="bg-green-500 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105">
                Download Flyer (PDF)
            </button>
        </div>

        <div id="error-message" class="hidden mt-4 p-3 bg-red-100 text-red-700 rounded-md">
            <!-- Error message will be displayed here -->
        </div>
    </div>

    <script>
        const downloadPngBtn = document.getElementById('downloadPngBtn');
        const downloadPdfBtn = document.getElementById('downloadPdfBtn');
        const errorMessageDiv = document.getElementById('error-message');

        const displayPetName = document.getElementById('displayPetName');
        const displayPetName2 = document.getElementById('displayPetName2');
        const displayPetBreed = document.getElementById('displayPetBreed');
        const displayPetColor = document.getElementById('displayPetColor');
        const displayMissingDate = document.getElementById('displayMissingDate');
        const displayLastSeenLocation = document.getElementById('displayLastSeenLocation');
        const displayPhoneNumber = document.getElementById('displayPhoneNumber');
        const displayRewardSection = document.getElementById('displayRewardSection');
        const displayRewardAmount = document.getElementById('displayRewardAmount');
        const displayPhotoPlaceholder = document.getElementById('displayPhotoPlaceholder');


        document.addEventListener('DOMContentLoaded', () => {
            const generatedPngData = sessionStorage.getItem('generatedFlyerPNG');
            const generatedPdfData = sessionStorage.getItem('generatedFlyerPDF');
            const flyerInputData = JSON.parse(sessionStorage.getItem('flyerInputData'));

            console.log('ThankYou page loaded.'); // Log page load
            console.log('Retrieved flyerInputData:', flyerInputData); // Log retrieved input data
            console.log('Retrieved generatedPngData (first 50 chars):', generatedPngData ? generatedPngData.substring(0, 50) + '...' : 'null'); // Log PNG data snippet
            console.log('Retrieved generatedPdfData (first 50 chars):', generatedPdfData ? generatedPdfData.substring(0, 50) + '...' : 'null'); // Log PDF data snippet


            if (flyerInputData) {
                // Populate the display flyer with stored input data
                displayPetName.textContent = flyerInputData.petName || '';
                displayPetName2.textContent = flyerInputData.petName || '';
                displayPetBreed.textContent = flyerInputData.petBreed || '';
                displayPetColor.textContent = flyerInputData.petColor || '';

                if (flyerInputData.missingDate) {
                    const dateObj = new Date(flyerInputData.missingDate + 'T00:00:00');
                    displayMissingDate.textContent = dateObj.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                } else {
                    displayMissingDate.textContent = '';
                }

                displayLastSeenLocation.textContent = flyerInputData.lastSeenLocation || '';
                displayPhoneNumber.textContent = flyerInputData.phoneNumber || '';

                const reward = parseFloat(flyerInputData.rewardAmount);
                if (!isNaN(reward) && reward > 0) {
                    displayRewardAmount.textContent = `$${reward.toFixed(2)}`;
                    displayRewardSection.style.display = 'block';
                } else {
                    displayRewardSection.style.display = 'none';
                }

                if (flyerInputData.petPhotoBase64) {
                    const img = document.createElement('img');
                    img.src = flyerInputData.petPhotoBase64;
                    displayPhotoPlaceholder.innerHTML = '';
                    displayPhotoPlaceholder.appendChild(img);
                } else {
                    displayPhotoPlaceholder.innerHTML = 'No photo available';
                }
                console.log('Flyer display populated with data.'); // Confirm population
            } else {
                errorMessageDiv.textContent = 'Flyer data not found. Please go back and create your flyer.';
                errorMessageDiv.classList.remove('hidden');
                console.warn('Flyer input data not found in sessionStorage.'); // Log missing data
            }


            if (generatedPngData) {
                downloadPngBtn.addEventListener('click', () => {
                    const a = document.createElement('a');
                    a.href = generatedPngData;
                    a.download = 'lost_pet_flyer.png';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    console.log('PNG download initiated.'); // Log download click
                });
                downloadPngBtn.disabled = false; // Ensure button is enabled
                downloadPngBtn.classList.remove('opacity-50', 'cursor-not-allowed'); // Remove disabled styles
                console.log('PNG download button enabled.'); // Confirm button enabled
            } else {
                downloadPngBtn.disabled = true;
                downloadPngBtn.classList.add('opacity-50', 'cursor-not-allowed');
                errorMessageDiv.textContent += ' (PNG download unavailable).'; // Add to existing message
                errorMessageDiv.classList.remove('hidden');
                console.warn('PNG flyer data not found, PNG download button disabled.'); // Log disabled button
            }

            if (generatedPdfData) {
                downloadPdfBtn.addEventListener('click', () => {
                    const a = document.createElement('a');
                    a.href = generatedPdfData;
                    a.download = 'lost_pet_flyer.pdf';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    console.log('PDF download initiated.'); // Log download click
                });
                downloadPdfBtn.disabled = false; // Ensure button is enabled
                downloadPdfBtn.classList.remove('opacity-50', 'cursor-not-allowed'); // Remove disabled styles
                console.log('PDF download button enabled.'); // Confirm button enabled
            } else {
                downloadPdfBtn.disabled = true;
                downloadPdfBtn.classList.add('opacity-50', 'cursor-not-allowed');
                errorMessageDiv.textContent += ' (PDF download unavailable).'; // Add to existing message
                errorMessageDiv.classList.remove('hidden');
                console.warn('PDF flyer data not found, PDF download button disabled.'); // Log disabled button
            }
        });
    </script>
</body>
</html>
